# MikoUtils

[*English*](https://github.com/Kirisoup/MikoUtils/blob/main/README.md)

一款依赖 [BePinEx](https://github.com/BepInEx/BepInEx) 注入器的人类一败涂地插件，致力于添加帮助主持多人房间的便利功能。

支持多语言！目前仅支持中文（简体）和英文，欢迎随时询问其他语言的支持 <3

## 安装：
1. 下载 [BePinEx 的最新发行版](https://github.com/BepInEx/BepInEx/releases/latest)。正常情况下应当下载名字为 `BepInEx_x86... .zip` 的文件；
2. 解压下载的文件并移动到游戏目录；
  - 即 `Human.exe` 所处的文件夹
  - 默认情况下应该为 `SteamLibrary\steamapps\common\Human Fall Flat`
  - 移动完毕后，请确认名为 `BepInEx` 的文件夹本身位于上述的目录中！
3. 启动一次游戏，再关闭；
  - 现在你应该会发现 `Human Fall Flat\BepInEx` 文件夹中生成了一些新的文件夹，其中包括一个名为 `Plugins` 的文件夹。
4. 下载 [MikoUtils 的最新版本](https://github.com/Kirisoup/MikoUtils/releases/latest)，将其移动至 `Human Fall Flat\BepInEx\Plugins` 目录中； 
5. 插件已成功安装！ 

## 功能：

> 注意：本插件的功能是为多人游戏主持编写，不应作为客机使用（即使你真的去用也不会有什么效果）。  
> 不过其中很多功能也可以在单人游戏中使用 :D

所有功能都可以使用原版的 `help` `/help` 指令找到！

### 多人游戏功能：

**强踢：**  
阻止开启了防踢的玩家在房间里恶心人。  
由于本游戏编写时的疏忽，使用更改过的客户端（插件/文件替换）的玩家可以轻易绕过 /kick 踢出指令。本功能通过强制断开对应玩家连接，解决了此问题（对方若是进一步尝试加入你的房间，也会被原版游戏阻止，且不知为何会导致他们游戏崩溃ww）

**断开玩家连接：**  
> 语法：`/disconnect(dc) <player#>`  
断开所选玩家与房间的连接。  
- 与 /kick 所不同的是，被断开的玩家还可再次加入房间;
- 注意：本功能并未足够打磨，导致断开玩家连接时对方客户端不会意识到连接已断开，导致对方角色冻在原地（对方仍然可以手动退出）。

**加入、退出消息**  
当玩家加入游戏、退出游戏时输出通知。

**切换广播：**  
> 语法：`/broadcast(bc)`  
切换是否将插件通知广播到公屏（默认情况下只有你自己会看到）。  
- 以 `=` 开头的消息只会被你自己看见；以 `#` 开头则可被房间中所有人看见。

**同步关卡：**  
> 语法：`/synclvl(sync)`  
本功能尝试修复客机-主机关卡不同步的问题（即由于连接问题导致关卡无法正确更新给玩家，比如说你的房间完成了豪宅关卡并加载进了火车，但是在房间内其他玩家那边看到的还是豪宅关卡）

### 加载作弊指令 (控制台指令)：

#### 优化原版 `level(l)` 与 `cp(c)` 指令的使用体验：  

**`level` 指令：**  
> 语法：`level(l) <level> <checkpoint?>`  
- `level` 指令不再需要第二个 <存档点> 值；
  > `level 0` 会简单加载豪宅关卡
  > `level 0 3` 依然会正常加载豪宅的第三个存档点，和原版一致
- `level` 指令可以加载额外关卡了！当输入的关卡序号大于普通关卡的数量时，本功能便会加载额外关卡（例如，`level 14` 会加载山顶关卡）
- 使用 `level +/-<数字?>` 相对于当前关卡加载其他关卡。
  > - `level +1` 以加载下一关，`level -2` 加载前第二关

**`cp` 指令：**  
> 语法：`cp(c) <checkpoint>`  
- 类似于 `level`, `cp +/-<数字r?>` 会相对于当前存档点加载存档点。

#### New commands:

**次要目标指令:**  
> 语法：`subobj(s) <sub-obj>`  
加载当前存档点下的次要目标（*次要目标点目前只用于工厂存档点一 —— 拉杆锻造谜题*）；
- 若是当前存档点下不存在次要目标，则会重载存档点。

**更改存档点指令:**  
> 语法：`changecp(cc) <checkpoint>`  
改变当前存档点，但是不重新加载。
- 可用于跳（回）到某一存档点，但是不打断其他玩家游戏、不复原地图道具
- 在游玩拥有复杂解密、重载时会出错的的工坊图时，本功能尤其有用

### 大厅设定 (聊天栏指令, 部分指令可在控制台输入):

原版大厅设定现在可以在关卡中通过指令更改了（意味着你不再需要回到大厅并丢失游戏进度）。

**切换“仅限邀请”：**  
> 语法：`/invonly(io)`  

**切换“参加正在进行的游戏”：**  
> 语法：`/joingame(jg)`  

**切换“锁定关卡”：**  
> 语法：`/locklvl(lockl)`  
阻止玩家通关关卡。
- 也可在单人游戏中通过控制台指令 `locklvl(lockl)` 使用；
- 单人、多人设定将会被同步设置。

**切换“锁定存档点"** (*本插件加入的新功能*)：  
> 语法：`/lockcp(lockc)`  
阻止玩家推进存档点进度；
- 也可在单人游戏中通过控制台指令 `lockcp(lockc)` 使用；
- 单人、多人设定将会被同步设置。
- *并不会* 阻止玩家载入当前存档点;
- 让关卡变得更难、阻止陌生人打乱你的游戏进度。

## 待办事项（画饼）: 
- 一些脑洞:
  - 抱团通关：只在所有玩家都起码通过一次通关点之后才能通关。
  - 让新玩家必须经过主机同意才能加入房间的设定

# 欢迎提交问题与功能建议！
